
variables:
  DEVELOPMENT_BRANCH: "develop"
  RELEASE_BRANCH: "main"
  DEMO_PROJECT_NAME: "MangoPayExampleCheckout"
  DEMO_PATH: "$CI_PROJECT_DIR/Examples/MangoPayExampleCheckout"
  DEMO_ARCHIVE_PATH: "$DEMO_PATH/build/Archive.xcarchive"
  DEMO_IPA_PATH: "$DEMO_PATH/build/MangoPayExampleCheckout.ipa"


stages:
  - build
  - archive
  - deploy
  
build_project:
  stage: build
  script:
     - echo "build"
     - echo $CI_PROJECT_DIR
    #- xcodebuild clean -workspace examples/CheckoutiOSDemoApp/CheckoutiOSDemoApp.xcodeproj/project.xcworkspace -disableAutomaticPackageResolution -scheme SchemeName | xcpretty 
    #- xcodebuild test -workspace examples/CheckoutiOSDemoApp/CheckoutiOSDemoApp.xcodeproj/project.xcworkspace -scheme SchemeName -destination 'platform=iOS Simulator,name=iPhone 12 Pro,OS=15.2' | xcpretty -s
  # tags:
  #  - ios-tag
  #  - version-1.0
archive_build:
  dependencies: []
  stage: archive
  artifacts:
    paths:
      - $DEMO_IPA_PATH
  script:
    - xcodebuild -project $DEMO_PATH/$DEMO_PROJECT_NAME.xcodeproj -scheme $DEMO_PROJECT_NAME -archivePath $DEMO_ARCHIVE_PATH archive
    - xcodebuild -exportArchive -archivePath $DEMO_ARCHIVE_PATH -exportPath $DEMO_PATH/build -exportOptionsPlist $DEMO_PATH/$DEMO_PROJECT_NAME/Info.plist
  # tags:
  #   - ios-tag
  #   - version-1.0
  only:
    - ci-config